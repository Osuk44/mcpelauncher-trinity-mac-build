name: Compilar Solo Launcher Trinity (Intel)
on: [workflow_dispatch]

jobs:
  build-launcher:
    runs-on: macos-15-intel
    
    steps:
      - name: 1. Instalar Qt6 (Necesario para la interfaz)
        run: |
          brew update
          brew install cmake ninja pkg-config qt6

      - name: 2. Compilar Trinity (Interfaz)
        run: |
          git clone https://github.com/Trinity-LA/Trinity-Launcher.git
          cd Trinity-Launcher
          # Aplicamos el parche de traducción para evitar errores de compilación
          sed -i '' 's/QDialogButtonBox::Cancelar/QDialogButtonBox::Cancel/g' src/TrinityLib/ui/windows/launcher_window.cpp || true
          
          mkdir build && cd build
          # Configuramos apuntando a las librerías de Qt6 de la Mac Intel
          cmake .. -GNinja \
            -DCMAKE_BUILD_TYPE=Release \
            -DCMAKE_OSX_ARCHITECTURES="x86_64" \
            -DCMAKE_PREFIX_PATH=$(brew --prefix qt6) \
            -DCMAKE_POLICY_VERSION_MINIMUM=3.5 \
            -Wno-dev
          ninja
          
          - name: 3. Recolectar Launcher y Soporte (Nombres Correctos)
          run: |
          mkdir -p final_launcher
          
          # Según el log, los archivos están en Trinity-Launcher/build/app/
          # Los copiamos con sus nombres reales
          cp Trinity-Launcher/build/app/trinchete final_launcher/ 2>/dev/null || true
          cp Trinity-Launcher/build/app/trinito final_launcher/ 2>/dev/null || true
          
          # Por si acaso el sistema les puso extensiones diferentes en Mac
          # buscamos cualquier cosa que se llame trinchete o trinito en la carpeta build
          find Trinity-Launcher/build -name "trinchete" -type f -exec cp {} final_launcher/ \;
          find Trinity-Launcher/build -name "trinito" -type f -exec cp {} final_launcher/ \;

          # Dar permisos de ejecución antes de empaquetar
          chmod +x final_launcher/*

      - name: 4. Subir Pack Trinity Final
        uses: actions/upload-artifact@v4
        with:
          name: Trinity-Intel-Pack-Completo
          path: final_launcher/
      

name: Compilar Minecraft Mac Full
on: [workflow_dispatch]

jobs:
  build-macos:
    runs-on: macos-latest
    
    steps:
      - name: 1. Instalar dependencias de Apple y Qt6
        run: |
          brew update
          brew install cmake ninja pkg-config qt6 sdl2 libpng jpeg-turbo libusb

      - name: 2. Clonar codigo (Recursivo para subm√≥dulos)
        run: |
          git clone --recursive https://codeberg.org/javiercplus/mcpelauncher-client-extend.git mcpelauncher

      - name: 3. Configurar CMake con todas las herramientas
        run: |
          cd mcpelauncher
          mkdir build && cd build
          cmake .. -GNinja \
            -DCMAKE_BUILD_TYPE=Release \
            -DENABLE_DEV_INSTALL=ON \
            -DBUILD_UI=ON \
            -DENABLE_XBL_WEBVIEW=ON \
            -DCMAKE_POLICY_VERSION_MINIMUM=3.5 \
            -DCMAKE_PREFIX_PATH=$(brew --prefix qt6)

      - name: 4. Compilacion General (Ninja)
        run: |
          cd mcpelauncher/build
          ninja

      - name: 5. Recolectar archivos para el Pack
        run: |
          mkdir -p final_output
          # Motor principal
          find mcpelauncher/build -name "mcpelauncher-client" -exec cp {} final_output/ \;
          # Lanzador Trinity (UI)
          find mcpelauncher/build -name "mcpelauncher-ui-qt" -exec cp {} final_output/ \;
          # Herramienta Trinito (Extract)
          find mcpelauncher/build -name "mcpelauncher-extract" -exec cp {} final_output/ \;
          # Reportador de errores
          find mcpelauncher/build -name "mcpelauncher-error" -exec cp {} final_output/ \;
          # Copiar Apps completas si existen
          find mcpelauncher/build -name "*.app" -exec cp -r {} final_output/ \;

      - name: 6. Subir Pack Final a GitHub
        uses: actions/upload-artifact@v4
        with:
          name: Minecraft-Mac-Intel-Full-Pack
          path: final_output/
          if-no-files-found: error

name: Compilar Trinity Intel - Pack Final
on: [workflow_dispatch]

jobs:
  build-launcher:
    runs-on: macos-15-intel
    
    steps:
      - name: 1. Instalar Dependencias
        run: |
          brew update
          brew install cmake ninja pkg-config qt6

      - name: 2. Compilar y Recolectar Trinity
        run: |
          # Clonar y entrar
          git clone https://github.com/Trinity-LA/Trinity-Launcher.git
          cd Trinity-Launcher
          
          # Aplicar parche de texto
          sed -i '' 's/QDialogButtonBox::Cancelar/QDialogButtonBox::Cancel/g' src/TrinityLib/ui/windows/launcher_window.cpp || true
          
          # Compilar
          mkdir build && cd build
          cmake .. -GNinja \
            -DCMAKE_BUILD_TYPE=Release \
            -DCMAKE_OSX_ARCHITECTURES="x86_64" \
            -DCMAKE_PREFIX_PATH=$(brew --prefix qt6) \
            -DCMAKE_POLICY_VERSION_MINIMUM=3.5 \
            -Wno-dev
          ninja
          
          # Recolectar archivos inmediatamente (estamos en Trinity-Launcher/build)
          mkdir -p ../../final_launcher
          cp app/trinchete ../../final_launcher/ 2>/dev/null || true
          cp app/trinito ../../final_launcher/ 2>/dev/null || true
          
          # Dar permisos
          chmod +x ../../final_launcher/*

      - name: 3. Subir Pack Trinity
        uses: actions/upload-artifact@v4
        with:
          name: Trinity-Intel-Pack-Completo
          path: final_launcher/

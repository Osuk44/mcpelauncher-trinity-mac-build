name: Compilar Trinity, Extract y Webview
on: [workflow_dispatch]

jobs:
  build-macos:
    runs-on: macos-latest
    
    steps:
      - name: 1. Instalar Dependencias (Incluyendo WebEngine)
        run: |
          brew update
          # qt6-webengine es vital para el webview de inicio de sesi√≥n
          brew install cmake ninja pkg-config qt6 sdl2 libzip libusb

      - name: 2. Compilar mcpelauncher-extract
        run: |
          git clone https://github.com/minecraft-linux/mcpelauncher-extract.git
          cd mcpelauncher-extract
          mkdir build && cd build
          cmake .. -GNinja -DCMAKE_BUILD_TYPE=Release
          ninja

      - name: 3. Compilar mcpelauncher-webview (Para Login)
        run: |
          git clone --recursive https://github.com/minecraft-linux/mcpelauncher-webview.git
          cd mcpelauncher-webview
          mkdir build && cd build
          # Forzamos la ruta de Qt6 para que encuentre el WebEngine
          cmake .. -GNinja \
            -DCMAKE_BUILD_TYPE=Release \
            -DCMAKE_PREFIX_PATH=$(brew --prefix qt6)
          ninja

      - name: 4. Compilar Trinity Launcher
        run: |
          git clone https://github.com/Trinity-LA/Trinity-Launcher.git
          cd Trinity-Launcher
          # Configuramos manualmente para asegurar compatibilidad con el webview
          mkdir build && cd build
          cmake .. -GNinja \
            -DCMAKE_BUILD_TYPE=Release \
            -DCMAKE_PREFIX_PATH=$(brew --prefix qt6)
          ninja

      - name: 5. Organizar Todo el Pack
        run: |
          mkdir -p final_output
          # Buscamos y copiamos los 3 componentes clave
          find mcpelauncher-extract/build -name "mcpelauncher-extract" -exec cp {} final_output/ \;
          find mcpelauncher-webview/build -name "mcpelauncher-webview" -exec cp {} final_output/ \;
          find Trinity-Launcher/build -name "mcpelauncher-ui-qt" -exec cp {} final_output/ \;
          # Si se crearon paquetes .app completos
          find . -name "*.app" -exec cp -r {} final_output/ \;

      - name: 6. Publicar Pack Completo
        uses: actions/upload-artifact@v4
        with:
          name: Minecraft-Mac-Trinity-Webview-Extract
          path: final_output/
          if-no-files-found: error
